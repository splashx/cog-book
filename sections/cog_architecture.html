

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>18. Cog Architecture &mdash; Cog Book 1.0.0 documentation</title>
  


    <link rel="shortcut icon" href="../_static/favicon.ico"/>


  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Cog Book 1.0.0 documentation" href="../index.html"/>
        <link rel="next" title="19. Command pipelines" href="command_pipelines.html"/>
        <link rel="prev" title="17. Developing a Trigger" href="developing_a_trigger.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cog Book
          

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
          </a>

          
            <img src="../_static/cog_peek.svg" class="logo" />
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">1. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="bootstrapping_cog.html">2. Bootstrapping Cog</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_and_managing_relays.html">3. Installing and Managing Relays</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands_and_bundles.html">4. Commands and Bundles</a></li>
<li class="toctree-l1"><a class="reference internal" href="managing_bundles.html">5. Managing Bundles</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_a_command_bundle.html">6. Writing A Command Bundle</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring_password_resets.html">7. Configuring password resets</a></li>
<li class="toctree-l1"><a class="reference internal" href="permissions_and_rules.html">8. Permissions and Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_execution_rules.html">9. Command Execution Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="bundle_configs.html">10. Bundle Configs</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_environment_variables.html">11. Command Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic_command_configuration.html">12. Dynamic Command Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="returning_data_from_cog.html">13. Returning data from Cog</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">14. Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">15. Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_your_first_command_bundle.html">16. Installing Your First Command Bundle</a></li>
<li class="toctree-l1"><a class="reference internal" href="developing_a_trigger.html">17. Developing a Trigger</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">18. Cog Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cog">18.1. Cog</a></li>
<li class="toctree-l2"><a class="reference internal" href="#postgresql">18.2. PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mqtt">18.3. MQTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#relay">18.4. Relay</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#code-isolation">18.4.1. Code isolation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#availability">18.4.2. Availability</a></li>
<li class="toctree-l3"><a class="reference internal" href="#language-choice">18.4.3. Language Choice</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cogctl">18.5. cogctl</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#more-information">18.5.1. More information</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_pipelines.html">19. Command pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="redirecting_pipeline_output.html">20. Redirecting Pipeline Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="triggers.html">21. Triggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_management.html">22. User management</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor_license_agreement.html">23. Contributor License Agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/cog_server_configuration.html">24. Cog Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/relay_configuration.html">25. Relay Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/command_output_tags.html">26. Command Output Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/greenbar_tags.html">27. Greenbar Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/audit_log_events.html">28. Audit Log Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/glossary.html">29. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/designing_for_chatops.html">30. Designing ChatOps Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/chat_platforms.html">31. Notes on Chat Platform Support</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cog Book</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          









<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>18. Cog Architecture</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/operable/cog-book/blob/HEAD/cog-book/source/sections/cog_architecture.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cog-architecture">
<h1>18. Cog Architecture<a class="headerlink" href="#cog-architecture" title="Permalink to this headline">¶</a></h1>
<p>A Cog chat system is composed of several interacting parts. Here, we
discuss them and how they relate.</p>
<p><img alt="Cog's Architecture" src="../_images/Operable_Diagram_CogArchitecture.png" /></p>
<div class="section" id="cog">
<h2>18.1. Cog<a class="headerlink" href="#cog" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/operable/cog">Cog</a> is the brains of the bot. It
processes chat requests and routes command invocations to Relay
instances. It also manages the logic of command pipelines. Finally, it
processes the final results of commands using chat system-specific
templates, and sends them back to the chat system.</p>
</div>
<div class="section" id="postgresql">
<h2>18.2. PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a></h2>
<p>Cog stores persistent data in <a class="reference external" href="http://postgresql.org">PostgreSQL</a>.
This includes information on all users, all bundles and commands, and
authorization information, including rules, permissions, roles, and
groups.</p>
</div>
<div class="section" id="mqtt">
<h2>18.3. MQTT<a class="headerlink" href="#mqtt" title="Permalink to this headline">¶</a></h2>
<p>Cog is built around a message bus architecture, specifically
<a class="reference external" href="http://mqtt.org/">MQTT</a>. This allows it to process multiple requests
concurrently, coordinating the processing among several relatively
simple and decoupled processes. It also permits transparent distribution
of work to other nodes; all command processing is dispatched to workers
via the message bus, allowing processing to occur within the bot itself
or on any number of associated Relay processes (see below), which may
run on completely separate machines.</p>
</div>
<div class="section" id="relay">
<h2>18.4. Relay<a class="headerlink" href="#relay" title="Permalink to this headline">¶</a></h2>
<p>With the exception of the embedded <code class="docutils literal"><span class="pre">operable</span></code> command bundle, all
command bundles run under a separate application known as a
<a class="reference external" href="https://github.com/operable/relay">Relay</a>. Relay serves as an
execution environment for commands; all chat commands ultimately get
routed to a Relay through Cog in order to be executed.</p>
<p>This provides several benefits.</p>
<div class="section" id="code-isolation">
<h3>18.4.1. Code isolation<a class="headerlink" href="#code-isolation" title="Permalink to this headline">¶</a></h3>
<p>As it is a completely separate process (potentially on an entirely
separate machine), any code running under a Relay will not have any
effect on the bot. You do not need to worry about conflicting
dependencies between a bundle and Cog breaking either one.</p>
<p>This isolation extends to intra-bundle conflicts as well. If you wish to
run two bundles that (for whatever reason) cannot coexist, you can run
each in their own Relay instance.</p>
</div>
<div class="section" id="availability">
<h3>18.4.2. Availability<a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h3>
<p>The same bundle may be installed on multiple Relay instances, allowing
Cog to distribute command executions across multiple Relays. If one
Relay goes down, Cog will recognize this and continue executing commands
on whatever other Relays are serving the bundle.</p>
</div>
<div class="section" id="language-choice">
<h3>18.4.3. Language Choice<a class="headerlink" href="#language-choice" title="Permalink to this headline">¶</a></h3>
<p>Since bundles do not run inside the bot, the implementation language of
the bot does not affect the language that bundles may be written in. In
fact, bundles may be written in whatever language you choose. Relay
simply acts as a mediator between the bot and the command execution.</p>
</div>
</div>
<div class="section" id="cogctl">
<h2>18.5. cogctl<a class="headerlink" href="#cogctl" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/operable/cogctl">cogctl</a> is the command-line tool
for interacting with a Cog system. It uses Cog’s REST API to perform
various administrative functions.</p>
<div class="section" id="more-information">
<h3>18.5.1. More information<a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><a class="reference internal" href="writing_a_command_bundle.html"><span class="doc">Writing A Command Bundle</span></a></div>
<div class="line"><a class="reference internal" href="managing_bundles.html"><span class="doc">Managing Bundles</span></a></div>
<div class="line"><a class="reference internal" href="installing_and_managing_relays.html"><span class="doc">Installing and Managing Relays</span></a></div>
<div class="line"><a class="reference internal" href="../references/relay_configuration.html"><span class="doc">Relay Configuration</span></a></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="command_pipelines.html" class="btn btn-neutral float-right" title="19. Command pipelines" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="developing_a_trigger.html" class="btn btn-neutral" title="17. Developing a Trigger" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 Operable, Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61670076-4', 'auto');
  ga('send', 'pageview');

  </script>
  


</body>
</html>